---

version: '3'

networks:
  traefik-frontend:
    external: true
services:
  proxy:
    image: traefik:v2.6
    restart: always
    networks:
      - traefik-frontend
    environment:
      TRAEFIK_CERTIFICATESRESOLVERS_LE_ACME_STORAGE: /certificates/acme.json
    volumes:
      - '/var/run/docker.sock:/var/run/docker.sock:ro'
      - './config/traefik-config.yaml:/etc/traefik/traefik.yaml'
      - './config/letsencrypt-certificates:/certificates'
    ports:
      - '80:80'
      - '443:443'
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.proxy.rule=Host(`traefik.opentelerehab.com`)"
      - "traefik.http.routers.proxy.tls=true"
      - "traefik.http.routers.proxy.tls.certresolver=letsencrypt"
      - "traefik.http.routers.proxy.service=api@internal"
      - "traefik.http.services.proxy.loadbalancer.server.port=8080"
      - "traefik.http.routers.proxy.middlewares=proxy-auth"
      - "traefik.http.middlewares.proxy-auth.basicauth.users=opentelerehab:$$apr1$$83i976ev$$WaM5Ay0XKTj38YZF3LNIB1"